// <copyright>
// Copyright by the Spark Development Network
//
// Licensed under the Rock Community License (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.rockrms.com/license
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// </copyright>
//
namespace Rock.Migrations
{
    using System;
    using System.Data.Entity.Migrations;
    
    /// <summary>
    ///
    /// </summary>
    public partial class RockJobServiceExternalFile : Rock.Migrations.RockMigration4
    {
        /// <summary>
        /// Operations to be performed during the upgrade process.
        /// </summary>
        public override void Up()
        {
            // JobService installer exe
            Sql( @"INSERT INTO [dbo].[BinaryFile] ([IsTemporary], [IsSystem], [BinaryFileTypeId], [Url], [FileName], [MimeType], [Description], [StorageEntityTypeId], [Guid]) 
                    VALUES (0, 0, 4, N'~/App_Data/ExternalFiles/cdc09f58-92cd-4b25-9ba9-793a72b707b6_setup.exe', N'setup.exe', N'application/octet-stream', N'The Rock Job Scheduler Service runs automated jobs as a windows service. Use the Rock Job Scheduler Service when you want the automated jobs to run as a windows service instead of within IIS.', 52, N'CDC09F58-92CD-4B25-9BA9-793A72B707B6')" );

            // JobService ExternalFile Image attribute BinaryFile
            Sql( @"INSERT INTO [dbo].[BinaryFile] ([IsTemporary], [IsSystem], [BinaryFileTypeId], [Url], [FileName], [MimeType], [Description], [StorageEntityTypeId], [Guid]) 
                    VALUES (0, 0, 3, N'~/GetFile.ashx?guid=987b6347-bfc2-446e-9376-f4336e90386d', N'job-service.svg', N'image/svg+xml', null, 51, N'987b6347-bfc2-446e-9376-f4336e90386d')" );

            Sql( @"
EXEC(N'INSERT INTO [dbo].[BinaryFileData] ([Id], [Content], [Guid]) VALUES ((select [Id] from BinaryFile where [Guid] = N''987b6347-bfc2-446e-9376-f4336e90386d''), 0x3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d227574662d38223f3e0d0a3c212d2d2047656e657261746f723a2041646f626520496c6c7573747261746f722031362e302e302c20535647204578706f727420506c75672d496e202e205356472056657273696f6e3a20362e3030204275696c6420302920202d2d3e0d0a3c21444f435459504520737667205055424c494320222d2f2f5733432f2f4454442053564720312e312f2f454e222022687474703a2f2f7777772e77332e6f72672f47726170686963732f5356472f312e312f4454442f73766731312e647464223e0d0a3c7376672076657273696f6e3d22312e31222069643d224c617965725f312220786d6c6e733d22687474703a2f2f7777772e77332e6f72672f323030302f7376672220786d6c6e733a786c696e6b3d22687474703a2f2f7777772e77332e6f72672f313939392f786c696e6b2220783d223070782220793d22307078220d0a092077696474683d223230312e333333707822206865696768743d223138342e3636377078222076696577426f783d22302030203230312e333333203138342e3636372220656e61626c652d6261636b67726f756e643d226e657720302030203230312e333333203138342e363637220d0a0920786d6c3a73706163653d227072657365727665223e0d0a3c673e0d0a093c706f6c79676f6e2066696c6c3d22234646464646462220706f696e74733d222d3135392e3833342c3130342e35202d3135392e3833342c323633202d34322e3333342c323633202d34322e3333342c3133352e35202d37382e3333342c3130312009222f3e0d0a093c7265637420783d222d34322e3333342220793d22313735222066696c6c3d2223374243333634222077696474683d22333022206865696768743d223334222f3e0d0a093c673e0d0a09093c706174682066696c6c3d22233235323532352220643d224d2d342e3834362c3233382e35323763302c312e3936332d312e3733322c332e3639352d332e3639362c332e363935682d32352e3837347631382e34383263302c362e3132312d342e3936372c31312e3038382d31312e3038392c31312e3038380d0a090909682d3131302e383839632d362e3132322c302d31312e3038392d342e3936372d31312e3038392d31312e303838762d31382e343832682d32352e383734632d312e3936342c302d332e3639362d312e3733322d332e3639362d332e363935762d34382e3035330d0a09090963302d31322e3132382c31302e3034392d32322e3137382c32322e3137382d32322e31373868372e333933563130352e343663302d362e3132322c342e3936372d31312e3038392c31312e3038392d31312e3038396837372e3632320d0a09090963362e3132322c302c31342e3535352c332e3436352c31382e3934332c372e3835346c31372e3535382c31372e35353863342e33392c342e3338392c372e3835342c31322e3832312c372e3835342c31382e3934337632392e353768372e3339330d0a0909096331322e3132392c302c32322e3137382c31302e30352c32322e3137382c32322e313738563233382e3532377a204d2d34392e3230312c3138332e303832762d34342e333535682d31382e343831632d362e3132322c302d31312e3038392d342e3936372d31312e3038392d31312e303839762d31382e3438310d0a090909682d37332e3932367637332e393235482d34392e3230317a204d2d34392e3230312c3235372e303038762d32392e3537682d3130332e3439367632392e3537482d34392e3230317a204d2d32372e3032332c3138332e303832632d342e3034332c302d372e3339332c332e33352d372e3339332c372e3339330d0a09090973332e33352c372e3339332c372e3339332c372e33393373372e3339332d332e33352c372e3339332d372e333933532d32322e39382c3138332e3038322d32372e3032332c3138332e3038327a222f3e0d0a093c2f673e0d0a093c673e0d0a09093c706174682066696c6c3d22233235323532352220643d224d2d36382e3632362c3135302e39303663302c312e3536382d312e32322c322e3738382d322e3738382c322e373838682d36312e333433632d312e3536382c302d322e3738382d312e32322d322e3738382d322e373838762d352e3537360d0a09090963302d312e3536392c312e32322d322e3738392c322e3738382d322e3738396836312e33343363312e3536382c302c322e3738382c312e32322c322e3738382c322e373839563135302e3930367a204d2d36382e3632362c3137332e3231320d0a09090963302c312e3536392d312e32322c322e3738382d322e3738382c322e373838682d36312e333433632d312e3536382c302d322e3738382d312e3231392d322e3738382d322e373838762d352e35373663302d312e3536382c312e32322d322e3738382c322e3738382d322e3738386836312e3334330d0a09090963312e3536382c302c322e3738382c312e32322c322e3738382c322e373838563137332e3231327a222f3e0d0a093c2f673e0d0a093c673e0d0a09093c706174682066696c6c3d22233235323532352220643d224d2d39322e3035392c3132382e38323563302c312e3536382d312e32322c322e3738392d322e3738382c322e373839682d33372e3931632d312e3536382c302d322e3738382d312e32322d322e3738382d322e373839762d352e3537360d0a09090963302d312e3536392c312e32322d322e3738392c322e3738382d322e3738396833372e393163312e3536382c302c322e3738382c312e32322c322e3738382c322e373839563132382e3832357a222f3e0d0a093c2f673e0d0a3c2f673e0d0a3c673e0d0a093c706174682066696c6c3d22233234323432342220643d224d3133332e3632312c3130342e39353363302c312e3238362d302e3938392c322e37372d322e3237352c322e3936386c2d31352e3333332c322e333734632d302e3739312c322e3537322d312e3837392c352e3034352d332e3136352c372e3531380d0a090963322e37372c332e3935372c352e3733372c372e3631372c382e3930322c31312e33373663302e3339362c302e3539342c302e3639322c312e3138372c302e3639322c312e39373963302c302e3639322d302e3139372c312e3338352d302e3639322c312e3837390d0a0909632d312e3937392c322e3637312d31332e3035382c31342e3733392d31352e3932362c31342e373339632d302e3739322c302d312e3438342d302e3239362d322e3037372d302e3639326c2d31312e3337372d382e393033632d322e3437332c312e3238372d342e3934362c322e3237352d372e3631372c332e3036370d0a0909632d302e3439352c352e3034352d302e3938392c31302e3438352d322e3237352c31352e333333632d302e3339362c312e3338352d312e3538332c322e3337342d322e3936382c322e3337344836312e313131632d312e3338352c302d322e37372d312e3038382d322e3936382d322e3437330d0a09096c2d322e3237352d31352e313336632d322e3537322d302e3739312d352e3034352d312e3837392d372e3431392d332e3036366c2d31312e3637332c382e383034632d302e3439352c302e3439352d312e3238362c302e3639322d312e3937392c302e3639320d0a0909632d302e3739322c302d312e3438342d302e3239362d322e3037382d302e373931632d322e3537322d322e3337342d31342e3234352d31322e3935392d31342e3234352d31352e38323863302d302e3639322c302e3239372d312e3238362c302e3639322d312e3837390d0a090963322e3836392d332e3735392c352e3833362d372e3431392c382e3730352d31312e323737632d312e3338352d322e3637312d322e3537322d352e3334322d332e3436322d382e3131316c2d31352e3033362d322e33373543372e3938392c3130372e3332372c372c3130362e3034312c372c3130342e3635360d0a09095638362e33353563302d312e3238362c302e3938392d322e37372c322e3237352d322e3936386c31352e3333332d322e33373463302e3739312d322e3537322c312e3837392d352e3034352c332e3136362d372e353138632d322e37372d332e3935372d352e3733382d372e3631372d382e3930332d31312e3337360d0a0909632d302e3339362d302e3539342d302e3639322d312e3238362d302e3639322d312e39373973302e3139382d312e3338352c302e3639322d312e39373963312e3937392d322e3637312c31332e3035382d31342e3634312c31352e3932372d31342e3634310d0a090963302e3739322c302c312e3438342c302e3239372c322e3037372c302e3639326c31312e3337362c382e39303363322e3437332d312e3238362c342e3934362d322e3237352c372e3631372d332e31363663302e3439352d342e3934362c302e3938392d31302e3338372c322e3237352d31352e3233340d0a090963302e3339362d312e3338352c312e3538332d322e3337342c322e3936382d322e3337344837392e353163312e3338352c302c322e37372c312e3038382c322e3936382c322e3437336c322e3237352c31352e31333563322e3537322c302e3739312c352e3034352c312e3837392c372e3431392c332e3036360d0a09096c31312e3637322d382e38303463302e3539342d302e3439352c312e3238372d302e3639322c312e3937392d302e36393263302e3739312c302c312e3438332c302e3239372c322e3037372c302e37393263322e3537322c322e3337342c31342e3234352c31332e3035382c31342e3234352c31352e3832380d0a090963302c302e3639322d302e3239372c312e3238362d302e3639332c312e383739632d322e3836382c332e3835382d352e3833362c372e3431392d382e3630352c31312e32373763312e3238362c322e3637312c322e3437332c352e3334322c332e3336332c382e3131316c31352e3033362c322e3237350d0a090963312e3338352c302e3239372c322e3337342c312e3538332c322e3337342c322e393638563130342e3935337a204d37302e3331312c37302e3333632d31332e3934382c302d32352e3332342c31312e3337362d32352e3332342c32352e3332347331312e3337362c32352e3332342c32352e3332342c32352e3332340d0a09097332352e3332342d31312e3337362c32352e3332342d32352e3332345338342e3235392c37302e33332c37302e3331312c37302e33337a222f3e0d0a3c2f673e0d0a3c673e0d0a093c706174682066696c6c3d22233443344334442220643d224d3138322e3139322c33352e303135632d302e3739322d312e3738312d312e3738312d332e3536312d322e3936382d352e31343463302e3839312d312e3937392c352e3034352d31312e3837312c352e3034352d31332e3635310d0a090963302d302e3139382d302e3039392d302e3439352d302e3339362d302e363932632d312e3138382d302e3639322d31312e3737322d362e3932342d31322e3236372d362e3932344c3137312e3031342c382e38632d332e3336332c332e3336332d362e3333312c372e3232312d392e3130312c31312e3037390d0a0909632d302e3938392d302e3039392d312e3937392d302e3139382d322e3936382d302e313938732d312e3937392c302e3039392d322e3936382c302e313938632d302e3938392d312e3438342d382e3430382d31312e3237372d392e3639342d31312e3237370d0a0909632d302e3439342c302d31312e3037392c362e3333312d31322e3236372c362e393234632d302e3239372c302e3139382d302e3339362c302e3439352d302e3339362c302e36393263302c312e3638322c342e3135342c31312e3637332c352e3034352c31332e3635310d0a0909632d312e3138372c312e3538332d322e3137362c332e3336332d322e3936382c352e313434632d312e3937392c302e3139382d31342e3733392c312e3538332d31342e3733392c332e3036367631332e383563302c312e3438332c31322e3736312c322e3836392c31342e3733392c332e3036360d0a090963302e3739322c312e3837392c312e3738312c332e3536312c322e3936382c352e313434632d302e3839312c312e3937392d352e3034352c31312e39372d352e3034352c31332e36353163302c302e3139382c302e3039392c302e3439352c302e3339362c302e3639320d0a090963312e3138382c302e3639322c31312e3737322c372e3032332c31322e3236372c372e30323363312e3238362c302c382e3730352d392e3839322c392e3639342d31312e33373663302e3938392c302e3039392c312e3937392c302e3139382c322e3936382c302e3139380d0a090973312e3937392d302e3039392c322e3936382d302e31393863302e3938392c312e3438342c382e3430382c31312e3337362c392e3639342c31312e33373663302e3439342c302c31312e3037392d362e3333312c31322e3236372d372e3032330d0a090963302e3239372d302e3139382c302e3339362d302e3339362c302e3339362d302e36393263302d312e3738312d342e3135342d31312e3637332d352e3034352d31332e36353163312e3138372d312e3538332c322e3137362d332e3236352c322e3936382d352e3134340d0a090963312e3937392d302e3139382c31342e3733392d312e3538332c31342e3733392d332e303636762d31332e3835433139362e3933322c33362e3539382c3138342e3137312c33352e3231322c3138322e3139322c33352e3031357a204d3135382e3934352c35372e3636380d0a0909632d362e3932352c302d31322e3636322d352e3633392d31322e3636322d31322e36363263302d362e3932352c352e3733372d31322e3636322c31322e3636322d31322e3636327331322e3636322c352e3733372c31322e3636322c31322e3636320d0a0909533136352e3936392c35372e3636382c3135382e3934352c35372e3636387a222f3e0d0a3c2f673e0d0a3c673e0d0a093c673e0d0a09093c706174682066696c6c3d226e6f6e652220643d224d3135382e3237392c3133352e353031632d362e3932352c302d31322e3636322c352e3733372d31322e3636322c31322e36363263302c372e3032332c352e3733372c31322e3636322c31322e3636322c31322e3636320d0a09090963372e3032332c302c31322e3636322d352e3733362c31322e3636322d31322e363632433137302e3934312c3134312e3233382c3136352e3230342c3133352e3530312c3135382e3237392c3133352e3530317a222f3e0d0a09093c706174682066696c6c3d22233443344334442220643d224d3138322e3532362c3133382e313732632d302e3739322d312e3738312d312e3738312d332e3536312d322e3936382d352e31343463302e3839312d312e3937392c352e3034352d31312e3837312c352e3034352d31332e3635310d0a09090963302d302e3139382d302e3039392d302e3439352d302e3339362d302e363932632d312e3138382d302e3639322d31312e3737322d362e3932342d31322e3236372d362e3932346c2d302e3539342c302e313938632d332e3336332c332e3336332d362e3333312c372e3232312d392e3130312c31312e3037390d0a090909632d302e3938392d302e3039392d312e3937392d302e3139382d322e3936382d302e313938732d312e3937392c302e3039392d322e3936382c302e313938632d302e3938392d312e3438342d382e3430382d31312e3237372d392e3639342d31312e3237370d0a090909632d302e3439342c302d31312e3037392c362e3333312d31322e3236372c362e393234632d302e3239372c302e3139382d302e3339362c302e3439352d302e3339362c302e36393263302c312e3638322c342e3135342c31312e3637332c352e3034352c31332e3635310d0a090909632d312e3138372c312e3538332d322e3137362c332e3336332d322e3936382c352e313434632d312e3937392c302e3139382d31342e3733392c312e3538332d31342e3733392c332e3036367631332e38353163302c312e3438322c31322e3736312c322e3836372c31342e3733392c332e3036360d0a09090963302e3739322c312e3837392c312e3738312c332e3536312c322e3936382c352e313433632d302e3839312c312e3937392d352e3034352c31312e3937312d352e3034352c31332e36353263302c302e3139372c302e3039392c302e3439342c302e3339362c302e3639310d0a09090963312e3138382c302e3639332c31312e3737322c372e3032352c31322e3236372c372e30323563312e3238362c302c382e3730352d392e3839332c392e3639342d31312e33373763302e3938392c302e312c312e3937392c302e3139372c322e3936382c302e3139370d0a09090973312e3937392d302e3039382c322e3936382d302e31393763302e3938392c312e3438342c382e3430382c31312e3337372c392e3639342c31312e33373763302e3439342c302c31312e3037392d362e3333322c31322e3236372d372e3032350d0a09090963302e3239372d302e3139372c302e3339362d302e3339352c302e3339362d302e36393163302d312e3738312d342e3135342d31312e3637342d352e3034352d31332e36353263312e3138372d312e3538322c322e3137362d332e3236342c322e3936382d352e3134330d0a09090963312e3937392d302e3139392c31342e3733392d312e3538342c31342e3733392d332e303636762d31332e383531433139372e3236362c3133392e3735352c3138342e3530352c3133382e33372c3138322e3532362c3133382e3137327a204d3135392e3237392c3136302e3832350d0a090909632d362e3932352c302d31322e3636322d352e3633392d31322e3636322d31322e36363263302d362e3932352c352e3733372d31322e3636322c31322e3636322d31322e3636327331322e3636322c352e3733372c31322e3636322c31322e3636320d0a090909433137312e3934312c3135352e3038392c3136362e3330332c3136302e3832352c3135392e3237392c3136302e3832357a222f3e0d0a093c2f673e0d0a3c2f673e0d0a3c2f7376673e0d0a, N''6AE0859C-3575-4964-9AE7-94B0D68BFD9E'')')
" );

            Sql( @"
INSERT INTO [dbo].[AttributeValue]
           ([IsSystem]
           ,[AttributeId]
           ,[EntityId]
           ,[Order]
           ,[Value]
           ,[Guid]
           )
     VALUES
           (0
           ,(select [Id] from Attribute where [Guid] = 'AE08EFC5-B8DD-45F0-8899-8ABA2726755E') -- External File Name
           ,(select [Id] from BinaryFile where [Guid] = 'CDC09F58-92CD-4B25-9BA9-793A72B707B6') -- setup binary file id
           ,0
           ,'Rock Job Scheduler Service'
           ,'7AEA5035-A2AC-47DC-A332-707479A1D502'
           )

INSERT INTO [dbo].[AttributeValue]
           ([IsSystem]
           ,[AttributeId]
           ,[EntityId]
           ,[Order]
           ,[Value]
           ,[Guid]
           )
     VALUES
           (0
           ,(select [Id] from Attribute where [Guid] = '5A4C4DF4-FF72-4327-9335-0C3669A4A34C') -- External File Icon
           ,(select [Id] from BinaryFile where [Guid] = 'CDC09F58-92CD-4B25-9BA9-793A72B707B6') -- setup binary file id
           ,0
           ,(select [Id] from BinaryFile where [Guid] = '987b6347-bfc2-446e-9376-f4336e90386d') -- Icon Binary File Id
           ,'69F04672-E464-49E5-B3E7-0F002CFD118D'
           )
" );


        }
        
        /// <summary>
        /// Operations to be performed during the downgrade process.
        /// </summary>
        public override void Down()
        {
            Sql( @"DELETE FROM AttributeValue where [Guid] = '69F04672-E464-49E5-B3E7-0F002CFD118D'" );
            Sql( @"DELETE FROM AttributeValue where [Guid] = '7AEA5035-A2AC-47DC-A332-707479A1D502'" );
            Sql( @"DELETE FROM BinaryFile where [Guid] = '987b6347-bfc2-446e-9376-f4336e90386d'" );
            Sql( @"DELETE FROM BinaryFile where [Guid] = 'CDC09F58-92CD-4B25-9BA9-793A72B707B6'" );
        }
    }
}
