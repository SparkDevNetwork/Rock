// <copyright>
// Copyright by LCBC Church
//
// Licensed under the Rock Community License (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.rockrms.com/license
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// </copyright>
//
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Rock.Plugin;

namespace com.lcbcchurch.Checkin.Migrations
{
    [MigrationNumber( 9, "1.0.14" )]
    class KVILabelAndMergeFields : Migration
    {
        public override void Up()
        {
            // Add the Merge Fields Needed for our custom labels
            RockMigrationHelper.AddDefinedValue( "E4D289A9-70FA-4381-913E-2A757AD11147", "Check-In Group Name", "The Check-In Group name that person checked into", "3B1DEC68-3BCD-41E7-8E69-3AD5B653666B", false );
            RockMigrationHelper.AddDefinedValue( "E4D289A9-70FA-4381-913E-2A757AD11147", "Check-In GroupType Name", "The Check-In Group Type name that the person checked into", "E7BA12F6-5733-4A85-B345-51999271B75C", false );
            RockMigrationHelper.AddDefinedValue( "E4D289A9-70FA-4381-913E-2A757AD11147", "Campus Ministry Name", "Combined Campus Short Code with Ministry name (i.e. CLM kidVenture Island)", "E2F06101-0112-490D-BE6E-3074F223214C", false );

            RockMigrationHelper.AddDefinedValueAttributeValue( "3B1DEC68-3BCD-41E7-8E69-3AD5B653666B", "51EB8583-55EA-4431-8B66-B5BD0F83D81E", @"{{ Group.Name }}" );
            RockMigrationHelper.AddDefinedValueAttributeValue( "E7BA12F6-5733-4A85-B345-51999271B75C", "51EB8583-55EA-4431-8B66-B5BD0F83D81E", @"{{ GroupType.Name }}" );
            RockMigrationHelper.AddDefinedValueAttributeValue( "E2F06101-0112-490D-BE6E-3074F223214C", "51EB8583-55EA-4431-8B66-B5BD0F83D81E", @"{% location Id:'{{ Location.Id }}' %}{% campus Id:'{{ location.CampusId }}' %}{{ campus.ShortCode }}{% endcampus %}{% endlocation %} {{ GroupType.MinistryName }}" );


            Sql( @"

    -- add the ZPL files and data for the labels 
    DECLARE @kidVentureIslandChildFileId INT
    DECLARE @kidVentureIslandParentFileId INT

    -- KVI Child Label
    INSERT INTO [BinaryFile] 
	    ([IsTemporary] 
	    ,[IsSystem] 
	    ,[BinaryFileTypeId]
	    ,[FileName] 
	    ,[MimeType] 
	    ,[Description] 
	    ,[StorageEntityTypeId] 
	    ,[Guid]
		,[Path]
		,[FileSize]) 
    VALUES
	    (0 
	    ,0 
	    ,1  
	    ,N'kidVenture Island - Child' 
	    ,N'text/plain' 
	    ,N'Child Label for kidVenture Island Check-In.' 
	    ,51
	    ,N'56FBDF5C-8E4C-43F5-9B22-B30D7A0E1067'
		,N'~/GetFile.ashx?guid=56fbdf5c-8e4c-43f5-9b22-b30d7a0e1067'
		,1664) 

    SET @kidVentureIslandChildFileId = SCOPE_IDENTITY() 

    INSERT INTO [BinaryFileData] 
	    ([Id] 
	    ,[Content] 
	    ,[Guid]) 
    VALUES
	    (@kidVentureIslandChildFileId 
	    ,0x1043547E7E43442C7E43435E7E43547E0A5E58417E54413030307E4A534E5E4C54305E4D4E575E4D54445E504F4E5E504D4E5E4C48302C305E4A4D415E5052362C367E534431355E4C524E5E434932385E585A0A5E58410A5E4D4D540A5E50573630390A5E4C4C303430360A5E4C53300A5E464F3335322C3136305E4746412C30343039362C30343039362C30303033322C3A5A36343A0A654A7A746C6A324F3154415167424E63754545794E37426F7559514C447349564B436D516B71637439696F494C70476E563142794265384E4C4E47344342356D786E5A694F3034512F63354B62364E3838586A2B375746346C566635503945416349454E6B4D7A6E712F3938676E4D4E77715574584A392F336A613574484545734364494D744B77396A476237306E42334D4D54653466576D6136464B6D49492B4F53375A69577841722F706235345564447955734D746959446B784C6C716F4468456F6C384D71447736596B735059526D69734D4379744136726D646D6F637144463455335052384658584764414E44366F4F414C516971774330366747654B71344F2F464878366344765A514448413461586B73736A6479556E37384B6541537750354C376533714557483365694679586E6C78674F656F5771567672314C5363316E6B3178394F756E6E517665486B7641382F4E437679333349387A61735337385031623869637A446743746E5675544446436F756946734E546A764D4F694345696976536A78587444664B5A61684F656B572F783063526E394176636849586E4D566D2F536D364973342F4D4855577A35454468467A73336B6566386A73514463307663546A452F6D51766971397A346B7669537A57657545722F6A467A585846622F68583679504F5A73666B487332326C4A64746E79717549696559483175376D45764A4B6373325A6C3437732B78346C596C2F707A37577852386F5445516931566D4C694F66636F32467946564F6E324A754D3538694479714858375076473965527239723275597A636D78772B51374D67385474344756544D35426165696763527564334755386B787447505576327A6A4457702B692F79573358745863697A6B652B5169752F632B3571626851533658664E585A2F492B52782F677A3532347A326277487A387143632F376331355A7A66516879676273706D7A386D376E644F6E584B7A4C63656F2F616255432B7130494C4A35346D66636D2B722F42546C614E324E453164427951533071365476735A506332632F6B7A31673431505455696A516C646A47376D4837372F774B47426F2B504E4E79776E2F4754652B59506E46653471467746634C6E373473754642506449385135557178485150513463374B6A30655836486C6C7563686C573438434F6153763043532F5177705430363963512F6255386B64484D542B67356637617A2B3175504A5065395079366D44587132373555764851486E3331756136685062746377353875724B64344C686657453765316737626C726E6167786F4E4D6B376C7648552B76385749354A585532353876354B696E506C3950343850766C77783735784C66424B4A30374952333653377065644F2B6B6D706564346B504264687A73376C73346B45744364726E4A482B692B6D6A303646787563424964466E51636E796E54752F5762696D664A58755A432F32487A5743773D3D3A453833340A5E465432362C39385E41304E2C38352C38345E46485C5E46444E69636B4E616D65313233345E46530A5E465432362C3135305E41304E2C35312C35305E46485C5E46444C6173744E616D6531323334353637385E46530A5E465432362C3235335E41304E2C32302C31395E46485C5E4644456E7669726F6E6D656E743132333435363738393031323334353637383930313233345E46530A5E465432362C3238325E41304E2C32332C32345E46485C5E4644446174653132333435363738393031323334353637383930315E46530A5E465432332C3335325E41304E2C34352C34355E46485C5E4644526F6F6D3132333435365E46530A5E46543236342C3335325E41304E2C34352C34355E46485C5E4644427265616B47726F75705E46530A5E46543438372C3335345E41304E2C35362C35355E46485C5E4644436F64655E46530A5E465432352C3232365E41304E2C32382C32385E46485C5E464443616D707573416E644D696E69737472795E46530A5E464F32342C3239355E47423538352C302C385E46530A5E464F32342C3337315E47423538352C302C355E46530A5E5051312C302C312C595E585A0A
	    ,'C0542BC5-C3BE-463A-B7C4-74B52F710532') 


    -- KVI Parent Label
    INSERT INTO [BinaryFile] 
	    ([IsTemporary] 
	    ,[IsSystem] 
	    ,[BinaryFileTypeId]
	    ,[FileName] 
	    ,[MimeType] 
	    ,[Description] 
	    ,[StorageEntityTypeId] 
	    ,[Guid]
		,[Path]
		,[FileSize]) 
    VALUES
	    (0 
	    ,0 
	    ,1  
	    ,N'kidVenture Island - Parent' 
	    ,N'text/plain' 
	    ,N'Parent Label for kidVenture Island Check-In.' 
	    ,51
	    ,N'50CFDC79-E5E1-459E-B7F9-9618B6A507A7'
		,N'~/GetFile.ashx?guid=50cfdc79-e5e1-459e-b7f9-9618b6a507a7'
		,3558) 

    SET @kidVentureIslandParentFileId = SCOPE_IDENTITY() 

    INSERT INTO [BinaryFileData] 
	    ([Id] 
	    ,[Content] 
	    ,[Guid]) 
    VALUES
	    (@kidVentureIslandParentFileId 
	    ,0x1043547E7E43442C7E43435E7E43547E0A5E58417E54413030307E4A534E5E4C54305E4D4E575E4D54445E504F4E5E504D4E5E4C48302C305E4A4D415E5052362C367E534431355E4C524E5E434932385E585A0A5E58410A5E4D4D430A5E50573630390A5E4C4C303430360A5E4C53300A5E464F3332302C3232345E4746412C30353736302C30353736302C30303033362C3A5A36343A0A654A7A746D457553354359515143586A434D334B38676D4D6A2B41546D4B7659742F444B3044454C5834754F76676754766F42326F7756576D76776741514C31624F336F6A4972714B756C312F73684D5545335468337A4966316755414F7A506941615534776C5A676556423077772B766473456853487A4B2F38784439612B7A782F736B794B5246467838754B3142724C6B5259535479704767624B69474A364E48416D43436F59783059572B41554E4F5A377A49556B526262726B433659493333724F4B5367464C2F30557130725A6C4D647032733153556E483656704E556D4A76537A593343415239433278746D573239465A70746D6269307761735741564274384B3348535634416175614F674738533144454677645A4D78785273706B3569423447395A6E716D494F6F71306263456F6878727864674255797A47626131596C704A5A766F4852704A70376979566746482B5669307275424454704F6353446D76467A77624137446C6E486E627052714357542F7A586464757963703474764C624E546D68782F63365438786D77554839383865486C6543345A43397A4D345251754E4938487379626D432B59345974324A4C765144653343664B524D483851457936746975715055765A6352587A30304A6857617A796D6674717053703876664C384A7A49525864584965494D762B4C7469496A4937426D65455361726761386B6F5A6E686445786B4D53466D2B6E66577A454C4F744633504D4C624E477642313077556A70666A345A513477336D6645326E6F7A50686346367144344F5973533356442B5A41645A544D6D75755135654C687934354F426D344D517466346E435042656D4E2F5539396B634F4348532F4E4A7A4E66544A3474756D4753756341785270316E6C4746475A53594664574D734D5A4B32534D593544326B6D354E4B416C6A4753683852734A344D754873764A35467A425A6B4E4F7A35414A4F63324B6D5867784F6A502B5369484F744A4A5A73457852587134555673794B4453534D4F72704D57705A55324635796C644F6A4B3338536332516D4C6A6B3968677134594E4C7165766D3839526D4E3679364D6C765238736C794342654D6C396D416B394238376A475847577A48314377775A6C30502F5752685A30354B5A6331692F31637A476A4D483071427A573738424C4B4B334A444E565958484C6A66476B596733455273326B4A61336F5642693747635638484F62354E387873417077783735783968614436345032344D6A7079646D496D5A2B5A773946324F6F4F413136687630656C62387848694D7969556C44413266617267535A466D536F3158464D4F6D5453414935546559497347447756574E797546357178376D52575972415A74676B6E642B444B6E4E6269684C432B5A6759585A795A474E3865447A4D79306A53686962484E2B306963445A435877686863713573764A4F4B7A62774A74516454625341556A4454507358476345676A78764463705137654F6D5132537A30354675593070625A54512B4A4E614E37544257376956326D79724D35656965662B73686E6A7436527054364347756964736C7A44764C786E3670724659314F70566D54756A30306C5A727346316836496464367A432F454E732B5A474833724D396430344856706D34655A37556B4D3767587057677A764B506A327234624E58475830624641716D724969732B3152713558467361476E4B44364B445652445235494E5936784A38414E2F5A722B455473687162754B534B356C4F664D51684A565A325476654F516144496A6A3872534750706C546D543066467738457A7A39684744657333523539454349706E642B30506951442F6D66794C2B43355454533A344141370A5E464F302C3232345E4746412C30353736302C30353736302C30303033362C3A5A36343A0A654A7A746C303275334367516747305244624D6A3263324F4B2B514534536F3579436A34365231736948495263674E3234345546557A39674177612F32535A36705661725A5839642F315847792F4975372F49727935705343732B4954696A78435A474A35586779354F4462414F536E6A4C6B4D7A70412F54765A4A55526278364E47693073625774686E426F5A4F69575A4C3047626D6447637349366C415459794B6467722F64694C6B515547534844716D4B69574233344E4361616E467956466A564D4C73594F4E327141535544703173316F4D54655339596879657462594C4A6E647058326A7245396338672B654E456A4B596B2B2B4E356A6B4A652B46322B6D4950497551514E547964755730514D6D6D44614A41314E703177307A4D70554F33535236454256555444574D6D5442314D555A4953724A6D68753530444C74544A38422F67712F5875716A6B547341756336777A30725761345135306D4358483651796B2B306650524D713234306279354F4F4E4F636776787746736450463778516832423158777A636A35754445653170796751714E4F73344E7A46624D53417A4D583172516C764C6B766F4D72556A43526D67396C64716664673048482B476B59524137656952415A75656B56642B50334B387865526543795451735A426130474F666A624D4E32514F544D412F7948694471744B2F4E624E477A4E724F4D38684D627373664A794E715A6D556D5A6361587349674A366D4C69326A4F4B474D2B4D514F62492F665236397278687870794D505754503843566E432B5073726B6F666271586F4438785A30414D766258513159684653344B614675536868396378364D5757334B476257776B44676766302F546B59336A4D53646D324D38644E6C6A706D464963575A32553172444D694E4F5268636D6D4649755771446B62475A7379554F772F6D4C306D5048576C525457544234675A6C784A73376778736A417656776F624268374B6F6A437663635A4130325A476C765241544B46686F416D5A69624B6B52392B594C544F484368566A57735979732B755348744D776D4536586D57427936482F4F47572B7A6D723973792B694C3255726F4834634D315851745958334F544F344E5A716A75555A5377507163384E6A666D6B47567776704A7A4B6558787A597A4773505432784644502B79385A57583457427037344B564C4B4E353539392F656441523932692B34764B6542514C7566754F526C487955526D705430546861735A53686E7544612B42676437416E62614C596B706344507A5849514D3739566A714579517A564D4556567A49776D36546437453547456F505441617362506F4737626C485643554836776C42666B67586448513875426F7373694448642B556D644450355845704F365536674B4A2B4E6F30766B527437654D54666C354642614F47494F4D4E34596C31716574326947396D7A51532F7A2B593270592B39416735576D5A34596D6C69313348494E486E5736585A3037454D485A6E526B4352337A4D6D426378376933544632376547344B65696B2F50365A5249625066417574502B724169623448356A70466C694B636545374F5A5A7A5734355831586A5236684E366A315751302B555937327A487444714875624E774933594378656E756547784F43676E46365033323431755741664C5046703170657A38545A45794E2B442F5A712B6A36357A453566594F706F50597761644C6A7667334F77446837496D5066586F6A535266786C4A6C6353425848303652533948327744776E75644C30394E4C2F4C752F793238682F5368346B4E513D3D3A383231340A5E465431352C35345E41304E2C32332C32345E46485C5E4644446174653132333435363738393031323334353637383930315E46530A5E46543332352C35335E41304E2C32332C32345E46485C5E4644446174653132333435363738393031323334353637383930315E46530A5E46543337302C3138355E41304E2C3131332C3131325E46485C5E46444B37595E46530A5E465436352C3138355E41304E2C3131332C3131325E46485C5E46444B37595E46530A5E46543131352C39325E41304E2C32352C32355E46485C5E4644526563656970745E46530A5E46543432302C39325E41304E2C32352C32355E46485C5E4644526563656970745E46530A5E46543137342C32385E41304E2C32332C32345E46485C5E464452657461696E207265636569707420666F72206368696C64207069636B75705E46530A5E4C52595E464F3330392C36345E47423239352C302C3133375E46535E4C524E0A5E4C52595E464F352C36355E47423239352C302C3133365E46535E4C524E0A5E464F3330342C33305E4742302C31352C315E46530A5E464F3330342C36305E4742302C31352C315E46530A5E464F3330342C39305E4742302C31352C315E46530A5E464F3330342C3132305E4742302C31352C315E46530A5E464F3330342C3135305E4742302C31352C315E46530A5E464F3330342C3138305E4742302C31352C315E46530A5E464F3330342C3231305E4742302C31352C315E46530A5E464F3330342C3234305E4742302C31352C315E46530A5E464F3330342C3237305E4742302C31352C315E46530A5E464F3330342C3330305E4742302C31352C315E46530A5E464F3330342C3333305E4742302C31352C315E46530A5E464F3330342C3336305E4742302C31352C315E46530A5E464F3330342C3339305E4742302C31352C315E46530A5E5051312C302C312C595E585A0A
	    ,'FE633208-1B6C-4EFD-806B-339FA96152B2')
" );
        }
    //--- add label attributes for the check-in groups (et91=GroupType, ft37=BinaryFile, etqv19-22=Nursery,Elem,JH,HS) 
    //--- set the qualifier value for the above attributes.



    //-- BinaryFile label attributes 
    //INSERT INTO [AttributeValue] 
	   // ([IsSystem] 
	   // ,[AttributeId] 
	   // ,[EntityId] 
	   // ,[Order] 
	   // ,[Value] 
	   // ,[Guid]) 
    //VALUES
	   // (1 
	   // ,399 
	   // ,@ChildLabelFileId 
	   // ,0 
	   // ,N'WWW^' + CAST(@SecurityCodeValueId AS VARCHAR) 
	   // + '|5^' + CAST(@NickNameValueId AS VARCHAR) 
	   // + '|6^' + CAST(@LastNameValueId AS VARCHAR) 
	   // + '|AAA^' + CAST(@AllergyIconValueId AS VARCHAR) 
	   // + '|LLL^' + CAST(@LegalIconValueId AS VARCHAR) 
	   // + '|2^'  + CAST(@BirthdayIconValueId AS VARCHAR) 
	   // + '|3^'  + CAST(@FirsttimeIconValueId AS VARCHAR) 
	   // + '|4^'  + CAST(@BirthdayDayofWeekValueId AS VARCHAR) 
	   // + '|10^' + CAST(@ScheduleTimesValueId AS VARCHAR) 
	   // + '|9^' + CAST(@LocationsValueId AS VARCHAR) 
	   // + '|' 
	   // ,'66eee8d3-e44e-446f-86a4-85f4a1061a24')

    //INSERT INTO [AttributeValue] 
	   // ([IsSystem] 
	   // ,[AttributeId] 
	   // ,[EntityId] 
	   // ,[Order] 
	   // ,[Value] 
	   // ,[Guid]) 
    //VALUES
	   // (1 
	   // ,399 
	   // ,@NameTagLabelFileId 
	   // ,0 
	   // ,N'NickName^' + CAST(@NickNameValueId AS VARCHAR) 
	   // + '|LastName^' + CAST(@LastNameValueId AS VARCHAR) + '|' 
	   // ,'839f5936-3f4a-4b7e-a47a-040e14f3c5d6') 
//" );
//        }

        public override void Down()
        {
            RockMigrationHelper.DeleteByGuid( "839f5936-3f4a-4b7e-a47a-040e14f3c5d6", "AttributeValue" );
        }
    }
}
