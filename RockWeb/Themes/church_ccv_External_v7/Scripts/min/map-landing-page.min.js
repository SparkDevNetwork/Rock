var CCV=CCV||{};CCV.mapStyles=[{stylers:[{visibility:"simplified"},{saturation:-100}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"},{gamma:3.05}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"administrative.country",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"off"}]},{}],CCV.mapType=new google.maps.StyledMapType(CCV.mapStyles),CCV.markerFile=window.devicePixelRatio>1.5?"http://www.ccvonline.com/Arena/Content/v6/img/maps/marker@2x.png":"http://www.ccvonline.com/Arena/Content/v6/img/maps/marker.png",CCV.marker=new google.maps.MarkerImage(CCV.markerFile,null,null,null,new google.maps.Size(30,38)),CCV.baseMap=function(i,e){this.holder=i,this.campusToDraw=e||"all",this.markers=[],this.bounds=new google.maps.LatLngBounds,this.zoom=this.zoom||12,this.mapOptions=this.mapOptions||{mapTypeId:"CCV",disableDefaultUI:!0}},CCV.baseMap.prototype={draw:function(){if(!this.holder)throw"Can't find map holder";this.map=new google.maps.Map(this.holder,this.mapOptions),this.map.mapTypes.set("CCV",CCV.mapType),this.dropMarkers(),this.fitMarkers(),this.bindUi()},dropMarkers:function(){if("all"==this.campusToDraw)for(var i=0;i<CCV.locations.length;i++){var e=CCV.locations[i];this.dropMarker(e)}else{var e=CCV.findCampusById(this.campusToDraw);this.dropMarker(e),this.useZoom=!0}},dropMarker:function(i){var e=new google.maps.Marker({position:new google.maps.LatLng(i.geo.lat,i.geo.lng),icon:CCV.marker,map:this.map,title:i.name,campusid:i.id,animation:google.maps.Animation.DROP});this.markers.push(e),this.bounds.extend(e.position),this.afterDropMarker(this,i,e)},afterDropMarker:function(){},fitMarkers:function(){this.map.setCenter(this.bounds.getCenter()),this.useZoom?this.map.setZoom(this.zoom):this.map.fitBounds(this.bounds)},bindUi:function(){var i=this;$(window).resize(function(){i.fitMarkers()})},getInstanceName:function(){for(var i in window)if(window[i]==this)return i}},CCV.infoWindowMap=function(i,e){CCV.baseMap.call(this,i,e),this.infowindow=new google.maps.InfoWindow({content:"Loading..."})},CCV.infoWindowMap.prototype=new CCV.baseMap,CCV.infoWindowMap.prototype.constructor=CCV.infoWindowMap,CCV.infoWindowMap.prototype.afterDropMarker=function(i,e,t){google.maps.event.addListener(t,"click",function(){i.infowindow.setContent(i.buildInfoWindow(e)),i.infowindow.open(i.map,this)})},CCV.infoWindowMap.prototype.buildInfoWindow=function(i){var e;return e='<div class="map-campus-infobox">',e+='  <div class="name">'+i.name+"</div>",e+='  <div class="cf">',e+='    <div class="details">',e+='      <span class="address">'+i.street+"<br>"+i.city+", "+i.state+" "+i.zip+"</span>",e+='      <span class="phone">'+i.phone+"</span>",e+="    </div>",e+="  </div>","function"==typeof this.selectCampus&&(e+='  <a class="cursor" onclick="'+this.getInstanceName()+".selectCampus("+i.id+')" class="select">Select this Campus</a>'),e+="</div>"};
var landingMap=new CCV.infoWindowMap(document.getElementById("map-holder"));landingMap.bindUi=function(){var n=this;$(window).resize(function(){n.fitMarkers()}),$(".js-find-nearest-campus").click(function(){n.findNearestCampus(n.openInfoWindow,this)})},landingMap.selectCampus=function(n){var a=CCV.findCampusById(n);alert(a.name)},landingMap.openInfoWindow=function(n){var a=this.markers.filter(function(a){return a.campusid==n.id})[0];this.infowindow.setContent(this.buildInfoWindow(n)),this.infowindow.open(this.map,a)},landingMap.findNearestCampus=function(n,a){function o(a,o){if(o==google.maps.DistanceMatrixStatus.OK){for(var i,s,r=Number.POSITIVE_INFINITY,l=a.rows[0].elements,d=0;d<l.length;d++)s=l[d].duration.value,r>s&&(r=s,i=d);e.removeClass("is-loading"),t.nearestCampus=CCV.locations[i],"function"==typeof n&&n.call(t,t.nearestCampus)}}var i,t=this,e=$(a),s=new google.maps.DistanceMatrixService;navigator.geolocation&&(e.addClass("is-loading"),navigator.geolocation.getCurrentPosition(function(n){i=new google.maps.LatLng(n.coords.latitude,n.coords.longitude),s.getDistanceMatrix({origins:[i],destinations:t.allLocationsGeoArray(),travelMode:google.maps.TravelMode.DRIVING},o)}))},landingMap.allLocationsGeoArray=function(){for(var n=[],a=0;a<CCV.locations.length;a++){var o=CCV.locations[a].geo,i=new google.maps.LatLng(o.lat,o.lng);n.push(i)}return n},landingMap.draw();