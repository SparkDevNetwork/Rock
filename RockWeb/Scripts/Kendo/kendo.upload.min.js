/*
* Kendo UI Web v2012.3.1114 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-web-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
(function(e,t){function n(t){return e.map(o(t),function(e){return e.name}).join(", ")}function o(e){var t=e[0];return t.files?a(t.files):[{name:s(t.value),extension:i(t.value),size:null}]}function a(t){return e.map(t,function(e){return r(e)})}function r(e){var t=e.name||e.fileName;return{name:t,extension:i(t),size:e.size||e.fileSize,rawFile:e}}function i(e){var t=e.match(_);return t?t[0]:""}function s(e){var t=e.lastIndexOf("\\");return-1!=t?e.substr(t+1):e}function l(t,n,o){if(n._supportsRemove()){var a=t.data("fileNames"),r=e.map(a,function(e){return e.name});n._submitRemove(r,o,function(e,o,r){n._removeFileEntry(t),n.trigger(b,{operation:"remove",files:a,response:e,XMLHttpRequest:r})},function(e){n.trigger(w,{operation:"remove",files:a,XMLHttpRequest:e}),g("Server response: "+e.responseText)})}}function p(t,n,o){var a=!1,r="";try{r=e.parseJSON(t),a=!0}catch(i){o()}a&&n(r)}function u(e){e.stopPropagation(),e.preventDefault()}function c(e,t,n,o){var a,r;e.on("dragenter"+t,function(){n(),r=new Date,a||(a=setInterval(function(){var e=new Date-r;e>100&&(o(),clearInterval(a),a=null)},100))}).on("dragover"+t,function(){r=new Date})}function d(e){return e.children(".k-icon").is(".k-loading, .k-success, .k-fail")}function f(t){return e(t.target).closest(".k-file")}function m(){var n={},o=e("meta[name=csrf-token]").attr("content"),a=e("meta[name=csrf-param]").attr("content");return e("input[name^='__RequestVerificationToken']").each(function(){n[this.name]=this.value}),a!==t&&o!==t&&(n[a]=o),n}var h=window.kendo,v=h.ui.Widget,g=h.logToConsole,_=/\.([^\.]+)$/,y=".kendoUpload",k="select",F="upload",b="success",w="error",x="complete",U="cancel",S="progress",R="remove",C=v.extend({init:function(t,n){var o=this;v.fn.init.call(o,t,n),o.name=t.name,o.multiple=o.options.multiple,o.localization=o.options.localization;var a=o.element;o.wrapper=a.closest(".k-upload"),0===o.wrapper.length&&(o.wrapper=o._wrapInput(a)),o._activeInput(a),o.toggle(o.options.enabled);var r=o._ns=y+"-"+h.guid();a.closest("form").on("submit"+r,e.proxy(o._onParentFormSubmit,o)).on("reset"+r,e.proxy(o._onParentFormReset,o)),o.options.async.saveUrl?(o._module=o._supportsFormData()?new I(o):new E(o),o._async=!0):o._module=new A(o),o._supportsDrop()&&o._setupDropZone(),o.wrapper.delegate(".k-upload-action","click",e.proxy(o._onFileAction,o)).delegate(".k-upload-selected","click",e.proxy(o._onUploadSelected,o)).delegate(".k-file","t:progress",e.proxy(o._onFileProgress,o)).delegate(".k-file","t:upload-success",e.proxy(o._onUploadSuccess,o)).delegate(".k-file","t:upload-error",e.proxy(o._onUploadError,o))},events:[k,F,b,w,x,U,S,R],options:{name:"Upload",enabled:!0,multiple:!0,showFileList:!0,async:{removeVerb:"POST",autoUpload:!0},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},setOptions:function(e){var t=this,n=t.element;v.fn.setOptions.call(t,e),t.multiple=t.options.multiple,n.attr("multiple",t._supportsMultiple()?t.multiple:!1),t.toggle(t.options.enabled)},enable:function(e){e=e===t?!0:e,this.toggle(e)},disable:function(){this.toggle(!1)},toggle:function(e){e=e===t?e:!e,this.wrapper.toggleClass("k-state-disabled",e)},destroy:function(){var t=this;e(document).add(e(".k-dropzone",t.wrapper)).add(t.wrapper.closest("form")).off(t._ns),v.fn.destroy.call(t)},_addInput:function(t){var n=this;t.insertAfter(n.element).data("kendoUpload",n),e(n.element).hide().removeAttr("id"),n._activeInput(t)},_activeInput:function(t){var n=this,o=n.wrapper;n.element=t,t.attr("multiple",n._supportsMultiple()?n.multiple:!1).attr("autocomplete","off").click(function(e){o.hasClass("k-state-disabled")&&e.preventDefault()}).change(e.proxy(n._onInputChange,n))},_onInputChange:function(t){var n=this,a=e(t.target),r=n.trigger(k,{files:o(a)});r?(n._addInput(a.clone().val("")),a.remove()):a.trigger("t:select")},_onDrop:function(t){var n=t.originalEvent.dataTransfer,o=this,r=n.files;if(u(t),r.length>0){var i=o.trigger(k,{files:a(r)});i||e(".k-dropzone",o.wrapper).trigger("t:select",[r])}},_enqueueFile:function(t,n){var o,a,r=this,i=e(".k-upload-files",r.wrapper);return 0===i.length&&(i=e("<ul class='k-upload-files k-reset'></ul>").appendTo(r.wrapper),r.options.showFileList||i.hide()),o=e(".k-file",i),a=e("<li class='k-file'><span class='k-filename' title='"+t+"'>"+t+"</span></li>").appendTo(i).data(n),r._async&&a.prepend("<span class='k-icon'></span>"),r.multiple||o.trigger("t:remove"),a},_removeFileEntry:function(t){var n,o=t.closest(".k-upload-files");t.remove(),n=e(".k-file",o),n.find("> .k-fail").length===n.length&&this._hideUploadButton(),0===n.length&&o.remove()},_fileAction:function(e,t){var n={remove:"k-delete",cancel:"k-cancel",retry:"k-retry"};n.hasOwnProperty(t)&&(this._clearFileAction(e),e.append(this._renderAction(n[t],this.localization[t]).addClass("k-upload-action")))},_fileState:function(e,t){var n=this.localization,o={uploading:{cssClass:"k-loading",text:n.statusUploading},uploaded:{cssClass:"k-success",text:n.statusUploaded},failed:{cssClass:"k-fail",text:n.statusFailed}},a=o[t];if(a){var r=e.children(".k-icon").text(a.text);r[0].className="k-icon "+a.cssClass}},_renderAction:function(t,n){return""!==t?e("<button type='button' class='k-button k-button-icontext'><span class='k-icon "+t+"'></span>"+n+"</button>"):e("<button type='button' class='k-button'>"+n+"</button>")},_clearFileAction:function(e){e.find(".k-upload-action").remove()},_onFileAction:function(t){var n=this;if(!n.wrapper.hasClass("k-state-disabled")){var o=e(t.target).closest(".k-upload-action"),a=o.find(".k-icon"),r=o.closest(".k-file"),i={files:r.data("fileNames")};a.hasClass("k-delete")?n.trigger(R,i)||r.trigger("t:remove",i.data):a.hasClass("k-cancel")?(n.trigger(U,i),r.trigger("t:cancel"),this._checkAllComplete()):a.hasClass("k-retry")&&r.trigger("t:retry")}return!1},_onUploadSelected:function(){return this.wrapper.trigger("t:saveSelected"),!1},_onFileProgress:function(t,n){var o=e(".k-progress-status",t.target);0===o.length&&(o=e("<span class='k-progress'><span class='k-state-selected k-progress-status' style='width: 0;'></span></span>").appendTo(e(".k-filename",t.target)).find(".k-progress-status")),o.width(n+"%"),this.trigger(S,{files:f(t).data("fileNames"),percentComplete:n})},_onUploadSuccess:function(e,t,n){var o=f(e);this._fileState(o,"uploaded"),this.trigger(b,{files:o.data("fileNames"),response:t,operation:"upload",XMLHttpRequest:n}),this._supportsRemove()?this._fileAction(o,R):this._clearFileAction(o),this._checkAllComplete()},_onUploadError:function(e,t){var n=f(e);this._fileState(n,"failed"),this._fileAction(n,"retry"),this.trigger(w,{operation:"upload",files:n.data("fileNames"),XMLHttpRequest:t}),g("Server response: "+t.responseText),this._checkAllComplete()},_showUploadButton:function(){var t=e(".k-upload-selected",this.wrapper);0===t.length&&(t=this._renderAction("",this.localization.uploadSelectedFiles).addClass("k-upload-selected")),this.wrapper.append(t)},_hideUploadButton:function(){e(".k-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){var t=this,n=t.element;if(n.trigger("t:abort"),!n.value){var o=e(n);o.attr("disabled","disabled"),window.setTimeout(function(){o.removeAttr("disabled")},0)}},_onParentFormReset:function(){e(".k-upload-files",this.wrapper).remove()},_supportsFormData:function(){return"undefined"!=typeof FormData},_supportsMultiple:function(){var e=this._userAgent().indexOf("Windows")>-1;return!(h.support.browser.opera||h.support.browser.safari&&e)},_supportsDrop:function(){var e=this._userAgent().toLowerCase(),t=/chrome/.test(e),n=!t&&/safari/.test(e),o=n&&/windows/.test(e);return!o&&this._supportsFormData()&&this.options.async.saveUrl},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){var t=this;e(".k-upload-button",this.wrapper).wrap("<div class='k-dropzone'></div>");var n=t._ns,o=e(".k-dropzone",t.wrapper).append(e("<em>"+t.localization.dropFilesHere+"</em>")).on("dragenter"+n,u).on("dragover"+n,function(e){e.preventDefault()}).on("drop"+n,e.proxy(this._onDrop,this));c(o,n,function(){o.addClass("k-dropzone-hovered")},function(){o.removeClass("k-dropzone-hovered")}),c(e(document),n,function(){o.addClass("k-dropzone-active")},function(){o.removeClass("k-dropzone-active")})},_supportsRemove:function(){return!!this.options.async.removeUrl},_submitRemove:function(t,n,o,a){var r=this,i=r.options.async.removeField||"fileNames",s=e.extend(n,m());s[i]=t,jQuery.ajax({type:this.options.async.removeVerb,dataType:"json",url:this.options.async.removeUrl,traditional:!0,data:s,success:o,error:a})},_wrapInput:function(e){return e.wrap("<div class='k-widget k-upload'><div class='k-button k-upload-button'></div></div>"),e.closest(".k-button").append("<span>"+this.localization.select+"</span>"),e.closest(".k-upload")},_checkAllComplete:function(){0===e(".k-file .k-icon.k-loading",this.wrapper).length&&this.trigger(x)}}),A=function(t){this.name="syncUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:remove",e.proxy(this.onRemove,this)).closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")};A.prototype={onSelect:function(t){var a=this.upload,r=e(t.target);a._addInput(r.clone().val(""));var i=a._enqueueFile(n(r),{relatedInput:r,fileNames:o(r)});a._fileAction(i,R)},onRemove:function(e){var t=f(e);t.data("relatedInput").remove(),this.upload._removeFileEntry(t)}};var E=function(t){this.name="iframeUploadModule",this.element=t.wrapper,this.upload=t,this.iframes=[],this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:cancel",e.proxy(this.onCancel,this)).bind("t:retry",e.proxy(this.onRetry,this)).bind("t:remove",e.proxy(this.onRemove,this)).bind("t:saveSelected",e.proxy(this.onSaveSelected,this)).bind("t:abort",e.proxy(this.onAbort,this))};C._frameId=0,E.prototype={onSelect:function(t){var n=this.upload,o=e(t.target),a=this.prepareUpload(o);n.options.async.autoUpload?this.performUpload(a):(n._supportsRemove()&&this.upload._fileAction(a,R),n._showUploadButton())},prepareUpload:function(t){var a=this.upload,r=e(a.element),i=a.options.async.saveField||t.attr("name");a._addInput(t.clone().val("")),t.attr("name",i);var s=this.createFrame(a.name+"_"+C._frameId++);this.registerFrame(s);var l=this.createForm(a.options.async.saveUrl,s.attr("name")).append(r),p=a._enqueueFile(n(t),{frame:s,relatedInput:r,fileNames:o(t)});return s.data({form:l,file:p}),p},performUpload:function(t){var n={files:t.data("fileNames")},o=t.data("frame"),a=this.upload;if(a.trigger(F,n))a._removeFileEntry(o.data("file")),this.cleanupFrame(o),this.unregisterFrame(o);else{a._hideUploadButton(),o.appendTo(document.body);var r=o.data("form").appendTo(document.body);n.data=e.extend({},n.data,m());for(var i in n.data){var s=r.find("input[name='"+i+"']");0===s.length&&(s=e("<input>",{type:"hidden",name:i}).appendTo(r)),s.val(n.data[i])}a._fileAction(t,U),a._fileState(t,"uploading"),o.one("load",e.proxy(this.onIframeLoad,this)),r[0].submit()}},onSaveSelected:function(){var t=this;e(".k-file",this.element).each(function(){var n=e(this),o=d(n);o||t.performUpload(n)})},onIframeLoad:function(t){var n,o=e(t.target);try{n=o.contents().text()}catch(t){n="Error trying to get server response: "+t}this.processResponse(o,n)},processResponse:function(t,n){var o=t.data("file"),a=this,r={responseText:n};p(n,function(n){e.extend(r,{statusText:"OK",status:"200"}),o.trigger("t:progress",[100]),o.trigger("t:upload-success",[n,r]),a.cleanupFrame(t),a.unregisterFrame(t)},function(){e.extend(r,{statusText:"error",status:"500"}),o.trigger("t:upload-error",[r])})},onCancel:function(t){var n=e(t.target).data("frame");this.stopFrameSubmit(n),this.cleanupFrame(n),this.unregisterFrame(n),this.upload._removeFileEntry(n.data("file"))},onRetry:function(e){var t=f(e);this.performUpload(t)},onRemove:function(e,t){var n=f(e),o=n.data("frame");o?(this.unregisterFrame(o),this.upload._removeFileEntry(n),this.cleanupFrame(o)):l(n,this.upload,t)},onAbort:function(){var t=this.element,n=this;e.each(this.iframes,function(){e("input",this.data("form")).appendTo(t),n.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(t){return e("<iframe name='"+t+"'"+" id='"+t+"'"+" style='display:none;' />")},createForm:function(t,n){return e("<form enctype='multipart/form-data' method='POST' action='"+t+"'"+" target='"+n+"'"+"/>")},stopFrameSubmit:function(e){e.stop!==t?e.stop():e.document&&(e.document.execCommand("Stop"),e.contentWindow.location.href=e.contentWindow.location.href)},registerFrame:function(e){this.iframes.push(e)},unregisterFrame:function(t){this.iframes=e.grep(this.iframes,function(e){return e.attr("name")!=t.attr("name")})},cleanupFrame:function(e){var t=e.data("form");e.data("file").data("frame",null),setTimeout(function(){t.remove(),e.remove()},1)}};var I=function(t){this.name="formDataUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:cancel",e.proxy(this.onCancel,this)).bind("t:remove",e.proxy(this.onRemove,this)).bind("t:retry",e.proxy(this.onRetry,this)).bind("t:saveSelected",e.proxy(this.onSaveSelected,this)).bind("t:abort",e.proxy(this.onAbort,this))};I.prototype={onSelect:function(t,n){var o=this.upload,r=this,i=e(t.target),s=n?a(n):this.inputFiles(i),l=this.prepareUpload(i,s);e.each(l,function(){o.options.async.autoUpload?r.performUpload(this):(o._supportsRemove()&&o._fileAction(this,R),o._showUploadButton())})},prepareUpload:function(t,n){var o=this.enqueueFiles(n);return t.is("input")&&(e.each(o,function(){e(this).data("relatedInput",t)}),t.data("relatedFileEntries",o),this.upload._addInput(t.clone().val(""))),o},enqueueFiles:function(t){var n,o,a,r,i=this.upload,s=t.length,l=[];if(i.options.async.batch===!0)n=e.map(t,function(e){return e.name}).join(", "),r=i._enqueueFile(n,{fileNames:t}),r.data("files",t),l.push(r);else for(o=0;s>o;o++)a=t[o],n=a.name,r=i._enqueueFile(n,{fileNames:[a]}),r.data("files",[a]),l.push(r);return l},inputFiles:function(e){return o(e)},performUpload:function(t){var n=this.upload,o=this.createFormData(t.data("files")),a={files:t.data("fileNames")};if(n.trigger(F,a))this.removeFileEntry(t);else{n._fileAction(t,U),n._hideUploadButton(),a.data=e.extend({},a.data,m());for(var r in a.data)o.append(r,a.data[r]);n._fileState(t,"uploading"),this.postFormData(this.upload.options.async.saveUrl,o,t)}},onSaveSelected:function(){var t=this;e(".k-file",this.element).each(function(){var n=e(this),o=d(n);o||t.performUpload(n)})},onCancel:function(e){var t=f(e);this.stopUploadRequest(t),this.removeFileEntry(t)},onRetry:function(e){var t=f(e);this.performUpload(t)},onRemove:function(e,t){var n=f(e);n.children(".k-icon").is(".k-success")?l(n,this.upload,t):this.removeFileEntry(n)},postFormData:function(e,t,n){var o=new XMLHttpRequest,a=this;n.data("request",o),o.addEventListener("load",function(e){a.onRequestSuccess.call(a,e,n)},!1),o.addEventListener(w,function(e){a.onRequestError.call(a,e,n)},!1),o.upload.addEventListener("progress",function(e){a.onRequestProgress.call(a,e,n)},!1),o.open("POST",e),o.withCredentials="true",o.send(t)},createFormData:function(e){var t,n=new FormData,o=this.upload,a=e.length;for(t=0;a>t;t++)n.append(o.options.async.saveField||o.name,e[t].rawFile);return n},onRequestSuccess:function(e,t){function n(){t.trigger("t:upload-error",[o])}var o=e.target,a=this;o.status>=200&&299>=o.status?p(o.responseText,function(e){t.trigger("t:progress",[100]),t.trigger("t:upload-success",[e,o]),a.cleanupFileEntry(t)},n):n()},onRequestError:function(e,t){var n=e.target;t.trigger("t:upload-error",[n])},cleanupFileEntry:function(t){var n=t.data("relatedInput"),o=!0;n&&(e.each(n.data("relatedFileEntries")||[],function(){this.parent().length>0&&this[0]!=t[0]&&(o=o&&this.children(".k-icon").is(".k-success"))}),o&&n.remove())},removeFileEntry:function(e){this.cleanupFileEntry(e),this.upload._removeFileEntry(e)},onRequestProgress:function(e,t){var n=Math.round(100*e.loaded/e.total);t.trigger("t:progress",[n])},stopUploadRequest:function(e){e.data("request").abort()}},h.ui.plugin(C)})(window.kendo.jQuery);