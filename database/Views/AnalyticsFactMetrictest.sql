/*
<auto-generated>
    This view was generated by the Rock's MetricService.EnsureMetricAnalyticsViews() which gets called when a Metric is saved.
    Changes to this view definition will be lost when the view is regenerated.
    NOTE: Any Views with the prefix 'AnalyticsFactMetric' are assumed to be Code Generated and may be deleted if there isn't a Metric associated with it
</auto-generated>
<doc>
	<summary>
 		This VIEW helps present the data for the test metric. 
	</summary>
</doc>
*/
ALTER VIEW [AnalyticsFactMetrictest] AS
SELECT p.*
 
FROM (
    SELECT pvt.Id
      ,cast(pvt.MetricValueDateTime AS DATE) AS [MetricValueDateTime]
      ,pvt.YValue
      ,pvt.IsGoal

    FROM (
        SELECT 
	      mv.Id
          ,mv.YValue
          ,mv.MetricValueDateTime
          ,case when MetricValueType = 1 then 1 else 0 end as IsGoal
          ,mvp.EntityId
          ,mp.Id [PartitionId]
        FROM MetricValue mv
        JOIN MetricValuePartition mvp ON mvp.MetricValueId = mv.Id
        JOIN MetricPartition mp ON mvp.MetricPartitionId = mp.Id
        WHERE mv.MetricId = 35
        ) src
    pivot(min(EntityId) FOR PartitionId IN ([0])) pvt
) p